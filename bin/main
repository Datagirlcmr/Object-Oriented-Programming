#!/usr/bin/env ruby

=begin
    Start the game
puts introduction
puts description
player enter their name
player1 choose its symbol
the symbol is set
It's the player1 turn
Loop {
    display the board

    The player1 enter the position of the case on the board
    If the player win then the game end or it's dram
    else

    display the board

    The player 2 enter the position of the case on the board
    If the player win then the game endor it's dram
    else
}

if game end,
    if player #{player} win, puts player wins
    if player #{player} loose, puts player loose
    If draw, puts the game is a draw
    Replay?
    
=end

class Game
    def initialize
        introduction
        @player1 =Player.new(1)
        @player2 =Player.new(2)
        @playing=true
        @player=nil
        @board = Board.new
        play
    end

    def introduction
        puts "Welcome to TIC TAC Toe"
        puts "Tic-tac-toe is a game for two players, X and O, who take turns marking 
        the spaces in a 3Ã—3 grid. The player who succeeds in placing 
        three of their marks in a horizontal, vertical, or diagonal row is the winner."
    end

    def play
        puts "Game start"
        player = @player1
        while @playing
            @board.display      
            puts " #{player.name} It is your turn to play"
            moves_error = true
            while moves_error
                puts "Select a move from the available moves: "
                puts @board.availables 
                num = gets.chomp.to_i
                num = num- 1
                if @board.is_available?(num)
                    moves_error = false
                @board.moves[num] = player.symbol
                else
                    puts "Your move is not available"  
                end
            end
            
            if is_a_win? 
                puts "Hourra #{player.name}. You Win!"
                @playing = false
                return
            end


            if player.number == @player1.number
                player = @player2
            else
                player = @player1
            end
        end   
    end

    def is_a_win?
        wins =[];
        wins << row1 = @board.moves[0].to_s + @board.moves[1].to_s + @board.moves[2].to_s # X+X+X => XXX // OOO
        wins << row2 = @board.moves[3].to_s + @board.moves[4].to_s + @board.moves[5].to_s
        wins << row3 = @board.moves[6].to_s + @board.moves[7].to_s + @board.moves[8].to_s
        wins << col1 = @board.moves[0].to_s + @board.moves[3].to_s + @board.moves[6].to_s
        wins << col2 = @board.moves[1].to_s + @board.moves[4].to_s + @board.moves[7].to_s
        wins << col3 = @board.moves[2].to_s + @board.moves[5].to_s + @board.moves[8].to_s
        wins << diag1 = @board.moves[0].to_s + @board.moves[4].to_s + @board.moves[8].to_s
        wins << diag2 = @board.moves[2].to_s + @board.moves[4].to_s + @board.moves[6].to_s
        
        player1_win = "XXX"
        player2_win = "OOO"
        wins.each do |x|
            if x== player1_win || x== player2_win
                return true
            end
        end
        return false
    end

    def Loose
    end
end

class Player
    attr_reader :number, :name,:symbol

    def initialize(number, name=nil)
        @number = number
        puts "Hello new Player. What's your Name?"
        @name = gets.chomp

        if number == 1
            @symbol = "X"
            puts "Your symbol is X"
        else
            @symbol = "O"
            puts "Your symbol is O"
        end
    end
end

class Board
    attr_accessor :moves
    def initialize
        @moves = [nil,nil,nil,nil,nil,nil,nil,nil,nil]
    end

    def is_available?(index)
        p @moves[index]
        return true if @moves[index].nil?
        false
    end

    def availables
       r = ""
       for i in 0...@moves.size
        r += "#{i+1} - " if @moves[i].nil?
       end
        r
    end

    def display
        lineblock= "================="
        linebreak = "----+----+-----+"
        line1=""
        line2=""
        line3=""
        (0..2).each do |x| 
            if @moves[x].nil?
                line1+="| #{x+1} |"
            else
                line1+="| #{@moves[x]} |"
            end
        end
        (3..5).each do |x|
            if @moves[x].nil?
                line2+="| #{x+1} |"
            else
                line2+="| #{@moves[x]} |"
            end
        end
        (6..8).each do |x|
            if @moves[x].nil?
                line3+="| #{x+1} |"
            else
                line3+="| #{@moves[x]} |"
            end
        end
        puts lineblock
        puts line1
        puts linebreak
        puts line2
        puts linebreak
        puts line3
        puts lineblock
        
    end
end

game = Game.new

# check = Board.new
# p check.availables

